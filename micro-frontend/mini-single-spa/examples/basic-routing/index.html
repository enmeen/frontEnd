<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Single-SPA - åŸºç¡€è·¯ç”±ç¤ºä¾‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .navigation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-links {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-link {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: #764ba2;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            min-height: 400px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .route-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .code-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .controls {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.secondary:hover {
            background: #5a6268;
        }

        .app-container {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            color: #6c757d;
            margin: 20px 0;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .feature-card h3 {
            margin-bottom: 10px;
        }

        .log-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.info { color: #4fc3f7; }
        .log-entry.success { color: #81c784; }
        .log-entry.warning { color: #ffb74d; }
        .log-entry.error { color: #e57373; }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.active {
            background: #28a745;
        }

        .status-indicator.inactive {
            background: #dc3545;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .nav-links {
                flex-direction: column;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§­ åŸºç¡€è·¯ç”±ç¤ºä¾‹</h1>
            <p>æ¼”ç¤º Mini Single-SPA çš„è·¯ç”±ç®¡ç†å’Œåº”ç”¨åŠ è½½æœºåˆ¶</p>
        </div>

        <div class="navigation">
            <div class="nav-links">
                <a href="/" class="nav-link" data-route="/">ğŸ  é¦–é¡µ</a>
                <a href="/dashboard" class="nav-link" data-route="/dashboard">ğŸ“Š ä»ªè¡¨æ¿</a>
                <a href="/profile" class="nav-link" data-route="/profile">ğŸ‘¤ ä¸ªäººèµ„æ–™</a>
                <a href="/settings" class="nav-link" data-route="/settings">âš™ï¸ è®¾ç½®</a>
                <a href="/about" class="nav-link" data-route="/about">â„¹ï¸ å…³äº</a>
            </div>
        </div>

        <div class="content">
            <div class="route-info">
                <h4>ğŸ“ å½“å‰è·¯ç”±ä¿¡æ¯</h4>
                <p><strong>è·¯å¾„:</strong> <span id="current-path">/</span></p>
                <p><strong>æ¿€æ´»çš„åº”ç”¨:</strong> <span id="active-apps">æ— </span></p>
                <p><strong>çŠ¶æ€:</strong> <span id="router-status">
                    <span class="status-indicator inactive"></span>æœªåˆå§‹åŒ–
                </span></p>
            </div>

            <div class="controls">
                <h4>ğŸ® è·¯ç”±æ§åˆ¶</h4>
                <button class="btn" onclick="navigateTo('/dashboard')">å¯¼èˆªåˆ°ä»ªè¡¨æ¿</button>
                <button class="btn" onclick="navigateTo('/profile')">å¯¼èˆªåˆ°ä¸ªäººèµ„æ–™</button>
                <button class="btn secondary" onclick="window.history.back()">è¿”å›ä¸Šä¸€é¡µ</button>
                <button class="btn secondary" onclick="window.history.forward()">å‰è¿›ä¸€é¡µ</button>
                <button class="btn" onclick="toggleRouter()">åˆ‡æ¢è·¯ç”±çŠ¶æ€</button>
            </div>

            <div id="app-container" class="app-container">
                <h3>ğŸ¯ è·¯ç”±æ¼”ç¤ºåŒºåŸŸ</h3>
                <p>ç‚¹å‡»ä¸Šæ–¹å¯¼èˆªé“¾æ¥æ¥æµ‹è¯•è·¯ç”±åŠŸèƒ½</p>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <h3>ğŸ¯ è·¯ç”±åŒ¹é…</h3>
                    <p>æ”¯æŒå¤šç§è·¯ç”±åŒ¹é…ç­–ç•¥ï¼šç²¾ç¡®åŒ¹é…ã€å‰ç¼€åŒ¹é…ã€æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç­‰</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ”„ è‡ªåŠ¨åŠ è½½</h3>
                    <p>æ ¹æ®URLè‡ªåŠ¨åŠ è½½å’Œå¸è½½å¯¹åº”çš„å¾®åº”ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ“Š çŠ¶æ€ç®¡ç†</h3>
                    <p>å®æ—¶è·Ÿè¸ªè·¯ç”±çŠ¶æ€å’Œåº”ç”¨çŠ¶æ€ï¼Œæä¾›å®Œæ•´çš„è°ƒè¯•ä¿¡æ¯</p>
                </div>
            </div>

            <div class="code-example">
<h4>ğŸ“ è·¯ç”±é…ç½®ç¤ºä¾‹</h4>
// åŸºç¡€è·¯ç”±é…ç½®
import { registerApplication, start } from '../../src/core/single-spa.js';

// æ³¨å†Œä»ªè¡¨æ¿åº”ç”¨
registerApplication(
  'dashboard',
  () => import('./apps/dashboard.js'),
  () => window.location.pathname.startsWith('/dashboard')
);

// æ³¨å†Œä¸ªäººèµ„æ–™åº”ç”¨
registerApplication(
  'profile',
  () => import('./apps/profile.js'),
  () => window.location.pathname === '/profile'
);

// å¯åŠ¨æ¡†æ¶
start();
            </div>

            <h4>ğŸ“‹ è·¯ç”±äº‹ä»¶æ—¥å¿—</h4>
            <div class="log-output" id="log-output">
                <div class="log-entry info">ç­‰å¾…è·¯ç”±äº‹ä»¶...</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { registerApplication, start, getApplications, on } from '../../src/core/single-spa.js';
        import { getCurrentPath, navigateTo, onRouteChange } from '../../src/core/router.js';

        // åº”ç”¨çŠ¶æ€
        let routerStarted = false;
        let appsRegistered = false;

        // æ—¥å¿—è¾“å‡º
        function log(message, type = 'info') {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logOutput.appendChild(logEntry);
            logOutput.scrollTop = logOutput.scrollHeight;

            // é™åˆ¶æ—¥å¿—æ¡æ•°
            if (logOutput.children.length > 50) {
                logOutput.removeChild(logOutput.firstChild);
            }
        }

        // æ›´æ–°è·¯ç”±ä¿¡æ¯æ˜¾ç¤º
        function updateRouteInfo() {
            const currentPath = getCurrentPath();
            document.getElementById('current-path').textContent = currentPath;

            const apps = getApplications();
            const activeApps = apps.filter(app => {
                const activeWhen = app.activeWhen;
                return typeof activeWhen === 'function' ? activeWhen() : false;
            });

            document.getElementById('active-apps').textContent =
                activeApps.length > 0 ? activeApps.map(app => app.name).join(', ') : 'æ— ';

            // æ›´æ–°å¯¼èˆªé“¾æ¥çŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(link => {
                const route = link.getAttribute('data-route');
                if (currentPath === route) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        // æ›´æ–°è·¯ç”±çŠ¶æ€
        function updateRouterStatus(active) {
            const statusElement = document.getElementById('router-status');
            if (active) {
                statusElement.innerHTML = '<span class="status-indicator active"></span>å·²å¯åŠ¨';
            } else {
                statusElement.innerHTML = '<span class="status-indicator inactive"></span>æœªå¯åŠ¨';
            }
        }

        // æ¨¡æ‹Ÿåº”ç”¨å†…å®¹
        function mockAppContent(appName, path) {
            const contents = {
                '/dashboard': `
                    <div style="text-align: center; padding: 40px;">
                        <h2>ğŸ“Š ä»ªè¡¨æ¿åº”ç”¨</h2>
                        <p>è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„ä»ªè¡¨æ¿åº”ç”¨</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                            <div style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
                                <h3>ç”¨æˆ·æ•°</h3>
                                <p style="font-size: 2rem; font-weight: bold;">1,234</p>
                            </div>
                            <div style="background: #f3e5f5; padding: 20px; border-radius: 8px;">
                                <h3>è®¢å•æ•°</h3>
                                <p style="font-size: 2rem; font-weight: bold;">567</p>
                            </div>
                            <div style="background: #e8f5e8; padding: 20px; border-radius: 8px;">
                                <h3>æ”¶å…¥</h3>
                                <p style="font-size: 2rem; font-weight: bold;">Â¥89,012</p>
                            </div>
                        </div>
                    </div>
                `,
                '/profile': `
                    <div style="text-align: center; padding: 40px;">
                        <h2>ğŸ‘¤ ä¸ªäººèµ„æ–™åº”ç”¨</h2>
                        <p>è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„ä¸ªäººèµ„æ–™åº”ç”¨</p>
                        <div style="max-width: 400px; margin: 30px auto; text-align: left;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">å§“å:</label>
                                <input type="text" value="å¼ ä¸‰" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">é‚®ç®±:</label>
                                <input type="email" value="zhangsan@example.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">éƒ¨é—¨:</label>
                                <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option>æŠ€æœ¯éƒ¨</option>
                                    <option>äº§å“éƒ¨</option>
                                    <option>å¸‚åœºéƒ¨</option>
                                </select>
                            </div>
                            <button style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">ä¿å­˜ä¿®æ”¹</button>
                        </div>
                    </div>
                `,
                '/settings': `
                    <div style="text-align: center; padding: 40px;">
                        <h2>âš™ï¸ è®¾ç½®åº”ç”¨</h2>
                        <p>è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„è®¾ç½®åº”ç”¨</p>
                        <div style="max-width: 500px; margin: 30px auto; text-align: left;">
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                                <h3>é€šçŸ¥è®¾ç½®</h3>
                                <label style="display: block; margin: 10px 0;">
                                    <input type="checkbox" checked> é‚®ä»¶é€šçŸ¥
                                </label>
                                <label style="display: block; margin: 10px 0;">
                                    <input type="checkbox"> çŸ­ä¿¡é€šçŸ¥
                                </label>
                                <label style="display: block; margin: 10px 0;">
                                    <input type="checkbox" checked> åº”ç”¨å†…é€šçŸ¥
                                </label>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                                <h3>éšç§è®¾ç½®</h3>
                                <label style="display: block; margin: 10px 0;">
                                    <input type="checkbox" checked> å…¬å¼€ä¸ªäººèµ„æ–™
                                </label>
                                <label style="display: block; margin: 10px 0;">
                                    <input type="checkbox"> æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€
                                </label>
                            </div>
                        </div>
                    </div>
                `,
                '/about': `
                    <div style="text-align: center; padding: 40px;">
                        <h2>â„¹ï¸ å…³äºåº”ç”¨</h2>
                        <p>è¿™æ˜¯ Mini Single-SPA æ¡†æ¶çš„æ¼”ç¤ºé¡µé¢</p>
                        <div style="max-width: 600px; margin: 30px auto; text-align: left;">
                            <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                <h3>ğŸš€ æ¡†æ¶ç‰¹æ€§</h3>
                                <ul>
                                    <li>æ¨¡å—åŒ–æ¶æ„ï¼Œæ˜“äºæ‰©å±•</li>
                                    <li>å¼ºå¤§çš„è·¯ç”±ç®¡ç†</li>
                                    <li>å®Œæ•´çš„åº”ç”¨ç”Ÿå‘½å‘¨æœŸ</li>
                                    <li>ä¸°å¯Œçš„è°ƒè¯•å·¥å…·</li>
                                </ul>
                            </div>
                            <div style="background: #f3e5f5; padding: 20px; border-radius: 8px;">
                                <h3>ğŸ“š å­¦ä¹ ç›®æ ‡</h3>
                                <ul>
                                    <li>ç†è§£å¾®å‰ç«¯æ¶æ„åŸç†</li>
                                    <li>æŒæ¡è·¯ç”±ç®¡ç†æœºåˆ¶</li>
                                    <li>å­¦ä¹ åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</li>
                                    <li>å®è·µæ²™ç®±éš”ç¦»æŠ€æœ¯</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `
            };

            return contents[path] || `
                <div style="text-align: center; padding: 40px;">
                    <h2>ğŸ  é¦–é¡µ</h2>
                    <p>æ¬¢è¿æ¥åˆ° Mini Single-SPA æ¼”ç¤ºé¡µé¢</p>
                    <p>è¯·ç‚¹å‡»ä¸Šæ–¹çš„å¯¼èˆªé“¾æ¥æ¥ä½“éªŒä¸åŒçš„å¾®åº”ç”¨</p>
                </div>
            `;
        }

        // æ³¨å†Œæ¨¡æ‹Ÿåº”ç”¨
        async function registerMockApps() {
            if (appsRegistered) return;

            // æ³¨å†Œä»ªè¡¨æ¿åº”ç”¨
            registerApplication(
                'dashboard',
                () => Promise.resolve({
                    mount: () => {
                        const container = document.getElementById('app-container');
                        container.innerHTML = mockAppContent('dashboard', '/dashboard');
                        container.className = '';
                        log('ä»ªè¡¨æ¿åº”ç”¨å·²æŒ‚è½½', 'success');
                    },
                    unmount: () => {
                        log('ä»ªè¡¨æ¿åº”ç”¨å·²å¸è½½', 'warning');
                    }
                }),
                () => getCurrentPath().startsWith('/dashboard')
            );

            // æ³¨å†Œä¸ªäººèµ„æ–™åº”ç”¨
            registerApplication(
                'profile',
                () => Promise.resolve({
                    mount: () => {
                        const container = document.getElementById('app-container');
                        container.innerHTML = mockAppContent('profile', '/profile');
                        container.className = '';
                        log('ä¸ªäººèµ„æ–™åº”ç”¨å·²æŒ‚è½½', 'success');
                    },
                    unmount: () => {
                        log('ä¸ªäººèµ„æ–™åº”ç”¨å·²å¸è½½', 'warning');
                    }
                }),
                () => getCurrentPath().startsWith('/profile')
            );

            // æ³¨å†Œè®¾ç½®åº”ç”¨
            registerApplication(
                'settings',
                () => Promise.resolve({
                    mount: () => {
                        const container = document.getElementById('app-container');
                        container.innerHTML = mockAppContent('settings', '/settings');
                        container.className = '';
                        log('è®¾ç½®åº”ç”¨å·²æŒ‚è½½', 'success');
                    },
                    unmount: () => {
                        log('è®¾ç½®åº”ç”¨å·²å¸è½½', 'warning');
                    }
                }),
                () => getCurrentPath().startsWith('/settings')
            );

            // æ³¨å†Œå…³äºåº”ç”¨
            registerApplication(
                'about',
                () => Promise.resolve({
                    mount: () => {
                        const container = document.getElementById('app-container');
                        container.innerHTML = mockAppContent('about', '/about');
                        container.className = '';
                        log('å…³äºåº”ç”¨å·²æŒ‚è½½', 'success');
                    },
                    unmount: () => {
                        log('å…³äºåº”ç”¨å·²å¸è½½', 'warning');
                    }
                }),
                () => getCurrentPath().startsWith('/about')
            );

            appsRegistered = true;
            log('æ‰€æœ‰æ¨¡æ‹Ÿåº”ç”¨å·²æ³¨å†Œ', 'success');
        }

        // å¯åŠ¨è·¯ç”±ç³»ç»Ÿ
        async function startRouter() {
            try {
                await registerMockApps();
                start();
                routerStarted = true;
                updateRouterStatus(true);
                updateRouteInfo();
                log('è·¯ç”±ç³»ç»Ÿå·²å¯åŠ¨', 'success');
            } catch (error) {
                log('è·¯ç”±ç³»ç»Ÿå¯åŠ¨å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åœæ­¢è·¯ç”±ç³»ç»Ÿ
        function stopRouter() {
            // ç®€å•çš„é‡ç½®å®ç°
            routerStarted = false;
            updateRouterStatus(false);
            location.reload();
        }

        // åˆ‡æ¢è·¯ç”±çŠ¶æ€
        window.toggleRouter = function() {
            if (routerStarted) {
                if (confirm('ç¡®å®šè¦åœæ­¢è·¯ç”±ç³»ç»Ÿå—ï¼Ÿ')) {
                    stopRouter();
                }
            } else {
                startRouter();
            }
        };

        // æš´éœ²ç»™å…¨å±€çš„å¯¼èˆªå‡½æ•°
        window.navigateTo = function(path) {
            if (routerStarted) {
                navigateTo(path);
            } else {
                window.location.pathname = path;
            }
        };

        // ç›‘å¬è·¯ç”±å˜åŒ–
        onRouteChange((route, previousRoute) => {
            log(`è·¯ç”±å˜åŒ–: ${previousRoute?.path || '/'} â†’ ${route.path}`, 'info');
            updateRouteInfo();
        });

        // ç›‘å¬åº”ç”¨äº‹ä»¶
        on('application-mounted', ({ name }) => {
            log(`åº”ç”¨ ${name} æŒ‚è½½æˆåŠŸ`, 'success');
        });

        on('application-unmounted', ({ name }) => {
            log(`åº”ç”¨ ${name} å¸è½½æˆåŠŸ`, 'warning');
        });

        // å¤„ç†å¯¼èˆªé“¾æ¥ç‚¹å‡»
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const path = link.getAttribute('data-route');
                navigateTo(path);
            });
        });

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œæ­£åœ¨åˆå§‹åŒ–è·¯ç”±ç³»ç»Ÿ...', 'info');

            // å»¶è¿Ÿå¯åŠ¨ï¼Œç¡®ä¿æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ
            setTimeout(() => {
                startRouter();
            }, 500);
        });

        // ç›‘å¬æµè§ˆå™¨å‰è¿›åé€€
        window.addEventListener('popstate', () => {
            updateRouteInfo();
        });
    </script>
</body>
</html>